jQuery.fn.farbtastic=function(a){$.farbtastic(this,a);return this};jQuery.farbtastic=function(a,b){var a=$(a).get(0);return a.farbtastic||(a.farbtastic=new jQuery._farbtastic(a,b))};jQuery._farbtastic=function(a,b){var c=this;$(a).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var d=$(".farbtastic",a);c.wheel=$(".wheel",a).get(0);c.radius=84;c.square=100;c.width=194;if(navigator.appVersion.match(/MSIE [0-6]\./)){$("*",d).each(function(){if(this.currentStyle.backgroundImage!="none"){var a=this.currentStyle.backgroundImage;a=this.currentStyle.backgroundImage.substring(5,a.length-2);$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"})}})}c.linkTo=function(a){if(typeof c.callback=="object"){$(c.callback).unbind("keyup",c.updateValue)}c.color=null;if(typeof a=="function"){c.callback=a}else if(typeof a=="object"||typeof a=="string"){c.callback=$(a);c.callback.bind("keyup",c.updateValue);if(c.callback.get(0).value){c.setColor(c.callback.get(0).value)}}return this};c.updateValue=function(a){if(this.value&&this.value!=c.color){c.setColor(this.value)}};c.setColor=function(a){var b=c.unpack(a);if(c.color!=a&&b){c.color=a;c.rgb=b;c.hsl=c.RGBToHSL(c.rgb);c.updateDisplay()}return this};c.setHSL=function(a){c.hsl=a;c.rgb=c.HSLToRGB(a);c.color=c.pack(c.rgb);c.updateDisplay();return this};c.widgetCoords=function(a){var b,d;var e=a.target||a.srcElement;var f=c.wheel;if(typeof a.offsetX!="undefined"){var g={x:a.offsetX,y:a.offsetY};var h=e;while(h){h.mouseX=g.x;h.mouseY=g.y;g.x+=h.offsetLeft;g.y+=h.offsetTop;h=h.offsetParent}var h=f;var i={x:0,y:0};while(h){if(typeof h.mouseX!="undefined"){b=h.mouseX-i.x;d=h.mouseY-i.y;break}i.x+=h.offsetLeft;i.y+=h.offsetTop;h=h.offsetParent}h=e;while(h){h.mouseX=undefined;h.mouseY=undefined;h=h.offsetParent}}else{var g=c.absolutePosition(f);b=(a.pageX||0*(a.clientX+$("html").get(0).scrollLeft))-g.x;d=(a.pageY||0*(a.clientY+$("html").get(0).scrollTop))-g.y}return{x:b-c.width/2,y:d-c.width/2}};c.mousedown=function(a){if(!document.dragging){$(document).bind("mousemove",c.mousemove).bind("mouseup",c.mouseup);document.dragging=true}var b=c.widgetCoords(a);c.circleDrag=Math.max(Math.abs(b.x),Math.abs(b.y))*2>c.square;c.mousemove(a);return false};c.mousemove=function(a){var b=c.widgetCoords(a);if(c.circleDrag){var d=Math.atan2(b.x,-b.y)/6.28;if(d<0)d+=1;c.setHSL([d,c.hsl[1],c.hsl[2]])}else{var e=Math.max(0,Math.min(1,-(b.x/c.square)+.5));var f=Math.max(0,Math.min(1,-(b.y/c.square)+.5));c.setHSL([c.hsl[0],e,f])}return false};c.mouseup=function(){$(document).unbind("mousemove",c.mousemove);$(document).unbind("mouseup",c.mouseup);document.dragging=false};c.updateDisplay=function(){var a=c.hsl[0]*6.28;$(".h-marker",d).css({left:Math.round(Math.sin(a)*c.radius+c.width/2)+"px",top:Math.round(-Math.cos(a)*c.radius+c.width/2)+"px"});$(".sl-marker",d).css({left:Math.round(c.square*(.5-c.hsl[1])+c.width/2)+"px",top:Math.round(c.square*(.5-c.hsl[2])+c.width/2)+"px"});$(".color",d).css("backgroundColor",c.pack(c.HSLToRGB([c.hsl[0],1,.5])));if(typeof c.callback=="object"){$(c.callback).css({backgroundColor:c.color,color:c.hsl[2]>.5?"#000":"#fff"});$(c.callback).each(function(){if(this.value&&this.value!=c.color){this.value=c.color}})}else if(typeof c.callback=="function"){c.callback.call(c,c.color)}};c.absolutePosition=function(a){var b={x:a.offsetLeft,y:a.offsetTop};if(a.offsetParent){var d=c.absolutePosition(a.offsetParent);b.x+=d.x;b.y+=d.y}return b};c.pack=function(a){var b=Math.round(a[0]*255);var c=Math.round(a[1]*255);var d=Math.round(a[2]*255);return"#"+(b<16?"0":"")+b.toString(16)+(c<16?"0":"")+c.toString(16)+(d<16?"0":"")+d.toString(16)};c.unpack=function(a){if(a.length==7){return[parseInt("0x"+a.substring(1,3))/255,parseInt("0x"+a.substring(3,5))/255,parseInt("0x"+a.substring(5,7))/255]}else if(a.length==4){return[parseInt("0x"+a.substring(1,2))/15,parseInt("0x"+a.substring(2,3))/15,parseInt("0x"+a.substring(3,4))/15]}};c.HSLToRGB=function(a){var b,c,d,e,f;var g=a[0],h=a[1],i=a[2];c=i<=.5?i*(h+1):i+h-i*h;b=i*2-c;return[this.hueToRGB(b,c,g+.33333),this.hueToRGB(b,c,g),this.hueToRGB(b,c,g-.33333)]};c.hueToRGB=function(a,b,c){c=c<0?c+1:c>1?c-1:c;if(c*6<1)return a+(b-a)*c*6;if(c*2<1)return b;if(c*3<2)return a+(b-a)*(.66666-c)*6;return a};c.RGBToHSL=function(a){var b,c,d,e,f,g;var h=a[0],i=a[1],j=a[2];b=Math.min(h,Math.min(i,j));c=Math.max(h,Math.max(i,j));d=c-b;g=(b+c)/2;f=0;if(g>0&&g<1){f=d/(g<.5?2*g:2-2*g)}e=0;if(d>0){if(c==h&&c!=i)e+=(i-j)/d;if(c==i&&c!=j)e+=2+(j-h)/d;if(c==j&&c!=h)e+=4+(h-i)/d;e/=6}return[e,f,g]};$("*",d).mousedown(c.mousedown);c.setColor("#000000");if(b){c.linkTo(b)}}