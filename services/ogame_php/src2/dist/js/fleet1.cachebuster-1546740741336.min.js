$(document).ready(function(){var FlightDuration;function addDots(Value){Value+="";for(var rgx=/(\d+)(\d\d\d)/;rgx.test(Value);)Value=Value.replace(rgx,"$1.$2");return Value}function setTarget(galaxy,system,planet,type){$("#galaxy_selector").val(galaxy),$("#system_selector").val(system),$("#select_planet").val(planet),$("#type_selector").val(type)}function distance(){var thisGalaxy=parseInt($("#ThisGalaxy").val(),10),thisSystem=parseInt($("#ThisSystem").val(),10),thisPlanet=parseInt($("#ThisPlanet").val(),10),targetGalaxy=parseInt($("#galaxy_selector").val(),10),targetSystem=parseInt($("#system_selector").val(),10),targetPlanet=parseInt($("#select_planet").val(),10),dist=0;return dist=targetGalaxy-thisGalaxy!=0?2e4*Math.abs(targetGalaxy-thisGalaxy):targetSystem-thisSystem!=0?95*Math.abs(targetSystem-thisSystem)+2700:targetPlanet-thisPlanet!=0?5*Math.abs(targetPlanet-thisPlanet)+1e3:5}function duration(){var ret=Math.round((35e3/speed()*Math.sqrt(10*distance()/maxspeed())+10)/speedFactor());return FlightDuration=ret,!0===AllowCreateTimeCounters&&createTimeCounters(),ret}function maxspeed(){return parseInt($("#MaxSpeed").val(),10)}function speed(){return parseFloat($(".setSpeed_Current").attr("data-speed"))}function speedFactor(){return parseInt($("#SpeedFactor").val(),10)}function consumption(){var calc_consumption=0,basicConsumption=0,i,dist=distance(),dur=duration(),speedfactor=speedFactor();for(i=200;i<300;i+=1){var ThisConsumption=$("#consumption"+i).val();if(void 0!==ThisConsumption&&""!==ThisConsumption){var spd=35e3/(dur*speedfactor-10)*Math.sqrt(10*dist/parseInt($("#speed"+i).val(),10));calc_consumption+=(basicConsumption=parseInt(ThisConsumption,10))*dist/35e3*(spd/10+1)*(spd/10+1)}}return calc_consumption=Math.round(calc_consumption)+1}function storage(){return parseInt($("#Storage").val(),10)-consumption()}function GetFuelStorage(){return parseInt($("#FuelStorage").val(),10)}function planetDeuterium(){return parseInt($("#PlanetDeuterium").val(),10)}function shortInfo(){$("#distance").html(addDots(distance()));var seconds=duration(),hours=Math.floor(seconds/3600);seconds-=3600*hours;var minutes=Math.floor(seconds/60);seconds-=60*minutes,minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),hours<10&&(hours="0"+hours),$("#duration").html(hours+":"+minutes+":"+seconds+" h");var stor=storage(),cons=consumption(),FuelStorage=GetFuelStorage();stor+=FuelStorage>=cons?cons:FuelStorage;var deuterium=planetDeuterium(),setHTMLCons="",setHTMLStor="";stor>=0?(setHTMLCons=deuterium>=cons?'<b class="lime">'+addDots(cons)+"</b>":'<b class="red">'+addDots(cons)+"</b>",setHTMLStor='<b class="lime">'+addDots(stor)+"</b>"):(setHTMLCons=deuterium>=cons?'<b class="orange">'+addDots(cons)+"</b>":'<b class="red">'+addDots(cons)+"</b>",setHTMLStor='<b class="red">'+addDots(stor)+"</b>"),$("#consumption").html(setHTMLCons),$("#storageShow").html(setHTMLStor)}function createTimeCounters(){var CurrentTime=(new Date).getTime()+ServerClientDifference,DateObj=new Date(CurrentTime),CTimeCounter=new Date(DateObj.getTime()),TimeCounter=new Date(DateObj.getTime()+1e3*FlightDuration),TimeCounter2=new Date(DateObj.getTime()+2*FlightDuration*1e3),CYears=CTimeCounter.getFullYear().toString().substr(2,2),CMonths=CTimeCounter.getMonth()+1,CDays=CTimeCounter.getDate(),CHours=CTimeCounter.getHours(),CMins=CTimeCounter.getMinutes(),CSecs=CTimeCounter.getSeconds();CYears<10&&(CYears=0===CYears?"00":"0"+CYears),CMonths<10&&(CMonths="0"+CMonths),CDays<10&&(CDays="0"+CDays),CHours<10&&(CHours=0===CHours?"00":"0"+CHours),CMins<10&&(CMins=0===CMins?"00":"0"+CMins),CSecs<10&&(CSecs=0===CSecs?"00":"0"+CSecs);var Years=TimeCounter.getFullYear().toString().substr(2,2),Months=TimeCounter.getMonth()+1,Days=TimeCounter.getDate(),Hours=TimeCounter.getHours(),Mins=TimeCounter.getMinutes(),Secs=TimeCounter.getSeconds();Years<10&&(Years=0===Years?"00":"0"+Years),Months<10&&(Months="0"+Months),Days<10&&(Days="0"+Days),Hours<10&&(Hours=0===Hours?"00":"0"+Hours),Mins<10&&(Mins=0===Mins?"00":"0"+Mins),Secs<10&&(Secs=0===Secs?"00":"0"+Secs);var Years2=TimeCounter2.getFullYear().toString().substr(2,2),Months2=TimeCounter2.getMonth()+1,Days2=TimeCounter2.getDate(),Hours2=TimeCounter2.getHours(),Mins2=TimeCounter2.getMinutes(),Secs2=TimeCounter2.getSeconds();Years2<10&&(Years2=0===Years2?"00":"0"+Years2),Months2<10&&(Months2="0"+Months2),Days2<10&&(Days2="0"+Days2),Hours2<10&&(Hours2=0===Hours2?"00":"0"+Hours2),Mins2<10&&(Mins2=0===Mins2?"00":"0"+Mins2),Secs2<10&&(Secs2=0===Secs2?"00":"0"+Secs2),$("#curr_time").html(CHours+":"+CMins+":"+CSecs+" - "+CDays+"."+CMonths+"."+CYears),$("#reach_time").html(Hours+":"+Mins+":"+Secs+" - "+Days+"."+Months+"."+Years),$("#comeback_time").html(Hours2+":"+Mins2+":"+Secs2+" - "+Days2+"."+Months2+"."+Years2)}$.fn.notEmptyVal=function(canBeZero){return canBeZero?""!=$(this).val()&&$(this).val()>=0:""!=$(this).val()&&$(this).val()>0},$.fn.notEmptyData=function(key){return""!=$(this).data(key)&&$(this).data(key)>0},setInterval(createTimeCounters,250),$("th:not(.FBlock, .inv), .updateInfo").addClass("pad2"),$(".updateInfo:not(.fastLink, select, .setSpeed)").keyup(function(){if($(this).notEmptyVal(!0)){var TName=$(this).attr("name");"galaxy"!=TName&&"system"!=TName&&"planet"!=TName||($(this).val()<1?$(this).val(1):$(this).val()>maxIs[TName]&&$(this).val(maxIs[TName])),shortInfo()}}).change(function(){$(this).keyup()}).focus(function(){$(this).notEmptyVal()&&($(this).data("last_val",$(this).val()),$(this).val(""))}).blur(function(){$(this).notEmptyVal()||$(this).notEmptyData("last_val")&&($(this).val($(this).data("last_val")),$(this).data("last_val",""))}),$("select.updateInfo:not(.fastLink)").keyup(function(){shortInfo()}).change(function(){$(this).keyup()}),$(".setSpeed").click(function(){return $('input[name="speed"]').val($(this).attr("data-speed")),$(".setSpeed_Selected").removeClass("setSpeed_Selected"),$(this).addClass("setSpeed_Selected"),shortInfo(),!1}).hover(function(){""!=$('input[name="galaxy"]').val()&&""!=$('input[name="system"]').val()&&""!=$('input[name="planet"]').val()&&($(".setSpeed_Current").removeClass("setSpeed_Current"),$(this).addClass("setSpeed_Current"),shortInfo())},function(){""!=$('input[name="galaxy"]').val()&&""!=$('input[name="system"]').val()&&""!=$('input[name="planet"]').val()&&($(this).removeClass("setSpeed_Current"),$(".setSpeed_Selected").addClass("setSpeed_Current"),shortInfo())}),$(".fastLink").keyup(function(){if("-"!==$(this).val()){var coordinates=$(this).val().split(",");setTarget(coordinates[0],coordinates[1],coordinates[2],coordinates[3]),shortInfo()}var GetIDNum=$(this).attr("id").substr(6);GetIDNum="1"==GetIDNum?2:1,$("#fl_sel"+GetIDNum).val("-").attr("selected",!0)}).change(function(){$(this).keyup()}),$("[name=galaxy]").tipTip({delay:0,edgeOffset:8,content:JSLang.fl1_targetGalaxy}),$("[name=system]").tipTip({delay:0,edgeOffset:8,content:JSLang.fl1_targetSystem}),$("[name=planet]").tipTip({delay:0,edgeOffset:8,content:JSLang.fl1_targetPlanet}),$("#goBack").click(function(){$("#thisForm").attr("action","fleet.php").prepend('<input type="hidden" name="gobackUsed" value="1"/>').submit()}),$("#thisForm").submit(function(){$("#galaxy_selector").notEmptyVal()||$("#galaxy_selector").notEmptyData("last_val")&&($("#galaxy_selector").val($("#galaxy_selector").data("last_val")),$("#galaxy_selector").data("last_val","")),$("#system_selector").notEmptyVal()||$("#system_selector").notEmptyData("last_val")&&($("#system_selector").val($("#system_selector").data("last_val")),$("#system_selector").data("last_val","")),$("#select_planet").notEmptyVal()||$("#select_planet").notEmptyData("last_val")&&($("#select_planet").val($("#select_planet").data("last_val")),$("#select_planet").data("last_val",""))}),shortInfo()});