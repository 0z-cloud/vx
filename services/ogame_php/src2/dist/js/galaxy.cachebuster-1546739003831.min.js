var BlockFunction=!0,HideTimeout=!1,RespCodes=new Array,Lang=new Array,LockGalaxyForm=!1,AjaxBox=!1,isReady=!1,icoTipObj={style:{classes:"tiptip_content"},show:{delay:500},position:{my:"top center",at:"bottom center",adjust:{y:10}}},El_FlyingFleets=!1;function galaxy_submit(value){if(!isReady)return!1;$("#auto").attr("name",value),$("#galaxy_form").submit()}function Phalanx(Galaxy,System,Planet,Type){var NewWindow;return window.open("phalanx.php?galaxy="+Galaxy+"&system="+System+"&planet="+Planet+"&planettype="+Type,"","resizable=yes,scrollbars=yes,menubar=no,toolbar=no,width=640,height=480,top=0,left=0").focus(),!1}function sendShips(missionType,Galaxy,System,Planet,PlanetType,Options){if(!isReady)return!1;if(!0!==BlockFunction){var requestPage,requestOpt,Mission;switch(BlockFunction=!0,missionType){case 1:requestPage="ajax/galaxyfleet.php",requestOpt={galaxy:Galaxy,system:System,planet:Planet,type:PlanetType,mission:Mission=6};break;case 2:requestPage="ajax/galaxyfleet.php",requestOpt={galaxy:Galaxy,system:System,planet:Planet,type:PlanetType,mission:Mission=8};break;case 3:requestPage="ajax/galaxyfleet.php",requestOpt={galaxy:Galaxy,system:System,planet:Planet,type:PlanetType,mission:Mission=7};break;case 4:Mission=10,requestPage="ajax/sendmissiles.php",requestOpt={galaxy:Galaxy,system:System,planet:Planet,count:Options.count,target:Options.target};break;default:requestPage="ajax/galaxyfleet.php",requestOpt={galaxy:Galaxy,system:System,planet:Planet,type:PlanetType,mission:Mission=6};break}$.post(requestPage,requestOpt).complete(function(response,requestStatus){if("success"==requestStatus){var data=response.responseText,retVals,Code,Update,Missiles,UsedSlots,Message,Infos,SpyProbes,Recyclers,Colonizers,ShipCount;BlockFunction=!1,!1!==HideTimeout&&clearTimeout(HideTimeout),10==Mission?(Code=(retVals=data.split("|"))[0],Update=retVals[1],Missiles=retVals[2],UsedSlots=retVals[3]):(Message=(retVals=data.split("|"))[0],UsedSlots=(retVals=(Infos=retVals[1]).split(","))[0],SpyProbes=retVals[1],Recyclers=retVals[2],Colonizers=retVals[3],Code=(retVals=Message.split(";"))[0],Update=retVals[1],ShipCount=retVals[2],Galaxy=retVals[3],System=retVals[4],Planet=retVals[5],PlanetType=retVals[6]);var CodeText=RespCodes[Code],textClass;if(CodeText.indexOf("xyz")>=0&&(CodeText=CodeText.replace("xyz",ShipCount)),CodeText.indexOf("replace_target")>=0){var AddReplace;AddReplace=3==PlanetType?" ("+Lang.ajax_moon_sign+")":"";var ReplaceTextNow=CodeText.replace("replace_target","["+Galaxy+":"+System+":"+Planet+"]"+AddReplace);CodeText=ReplaceTextNow}ShowAjaxInfo(CodeText,textClass=Code.indexOf("600")>=0?"lime":"red"),1==Update&&(10==Mission?($("#missiles, #missiles2").html(Missiles),El_FlyingFleets.html(UsedSlots)):(El_FlyingFleets.html(UsedSlots),$("#probes").html(SpyProbes),$("#recyclers").html(Recyclers),$("#colonizers").html(Colonizers)))}else{var ThisRespCode=0;ShowAjaxInfo(RespCodes[ThisRespCode="timeout"==requestStatus?"696":"698"],"red",1500)}})}return!1}function ShowAjaxInfo(Text,Color,HideTime){!1!==HideTimeout&&clearTimeout(HideTimeout),AjaxBox.th.show(0),AjaxBox.info.html(Text).css("color",Color),void 0===HideTime&&(HideTime=-1),HideTime>=0&&(HideTimeout=setTimeout(function(){AjaxBox.th.hide(400),HideTimeout=!1},HideTime))}$(document).ready(function(){isReady=!0;var ThisGalaxy=$('[name="galaxy"]'),ThisSystem=$('[name="system"]'),GalRows=$("#galRows"),AutoInput=$("#auto"),colonizedCount=$("#colonizedCount"),LeftMenu_Messages=$("#lm_msg"),MissilesForm=$("#MissileForm"),MissilesFields={galaxy:$('[name="m_galaxy"]',MissilesForm),system:$('[name="m_system"]',MissilesForm),planet:$('[name="m_planet"]',MissilesForm)},CurrentMissilesPos="0:0:0",MissilesPos=$("#MissilePos");function addDots(value){value+="";for(var rgx=/(\d+)(\d\d\d)/;rgx.test(value);)value=value.replace(rgx,"$1.$2");return value}function removeNonDigit(Value){return Value=(Value+="").replace(/[^0-9]/g,"")}if(AjaxBox={th:$("#fleetstatusrow"),info:$("#ajaxInfoBox")},El_FlyingFleets=$("#slots"),$.fn.prettyInputBox=function(){return this.each(function(){if(void 0!==AllowPrettyInputBox&&!0===AllowPrettyInputBox){var Value=removeNonDigit($(this).val());Value=addDots(Value),$(this).val(Value)}})},BlockFunction=!1,$("#closeMF").click(function(){!0===UseAjax?(CurrentMissilesPos="0:0:0",MissilesForm.hide("fast")):document.location.href=document.location.href.replace("mode=2","mode=3")}),$(document).on("click",".icoMissile",function(){if(nd(),!0===UseAjax){var RegExp,GetPos=/galaxy=([0-9]{1,3}).*?system=([0-9]{1,3}).*?planet=([0-9]{1,3})/gi.exec($(this).attr("href")),ThisPos;return GetPos[1]+":"+GetPos[2]+":"+GetPos[3]!=CurrentMissilesPos?(MissilesFields.galaxy.val(GetPos[1]),MissilesFields.system.val(GetPos[2]),MissilesFields.planet.val(GetPos[3]),CurrentMissilesPos=GetPos[1]+":"+GetPos[2]+":"+GetPos[3],$("body").animate({scrollTop:0},"fast"),MissilesForm.is(":visible")?MissilesPos.fadeOut("fast",function(){MissilesPos.html(CurrentMissilesPos),$(this).fadeIn("fast")}):(MissilesPos.html(CurrentMissilesPos),MissilesForm.show("fast"))):(CurrentMissilesPos="0:0:0",MissilesForm.hide("fast")),!1}}).on("mouseover",".icoTip",function(){!0!==$(this).data("hasTip")&&($(this).hasClass("icoMissile")?$(this).qtip($.extend(icoTipObj,{content:Lang.icoTip_missile})):$(this).hasClass("icoSpy")?$(this).qtip($.extend(icoTipObj,{content:Lang.icoTip_spy})):$(this).hasClass("icoMsg")?$(this).qtip($.extend(icoTipObj,{content:Lang.icoTip_msg})):$(this).hasClass("icoBuddy")&&$(this).qtip($.extend(icoTipObj,{content:Lang.icoTip_buddy})),$(this).data("hasTip",!0).trigger("mouseover"))}),$("#MissileForm").submit(function(){return sendShips(4,MissilesFields.galaxy.val(),MissilesFields.system.val(),MissilesFields.planet.val(),1,{count:$('[name="m_count"]').val(),target:$('[name="m_target"]').val()}),!1}),$('[name="m_count"]').change(function(){$(this).prettyInputBox()}).keyup(function(){$(this).change()}).keydown(function(){$(this).change()}),$("#galaxy_form").submit(function(){if(!0===UseAjax){if(!1===LockGalaxyForm){LockGalaxyForm=!0,(""==ThisGalaxy.val()||isNaN(ThisGalaxy.val()))&&ThisGalaxy.val(1),(""==ThisSystem.val()||isNaN(ThisSystem.val()))&&ThisSystem.val(1);var OldGalaxy=parseInt(ThisGalaxy.val(),10),OldSystem=parseInt(ThisSystem.val(),10),ThisName;if(void 0!==AutoInput.attr("name")&&""!=AutoInput.attr("name"))switch(AutoInput.attr("name")){case"galaxyLeft":1==ThisGalaxy.val()?ThisGalaxy.val(GalaxySettings.maxGal):ThisGalaxy.val(parseInt(ThisGalaxy.val(),10)-1);break;case"galaxyRight":ThisGalaxy.val()==GalaxySettings.maxGal?ThisGalaxy.val(1):ThisGalaxy.val(parseInt(ThisGalaxy.val(),10)+1);break;case"systemLeft":1==ThisSystem.val()?(ThisSystem.val(GalaxySettings.maxSys),1==ThisGalaxy.val()?ThisGalaxy.val(GalaxySettings.maxGal):ThisGalaxy.val(parseInt(ThisGalaxy.val(),10)-1)):ThisSystem.val(parseInt(ThisSystem.val(),10)-1);break;case"systemRight":ThisSystem.val()==GalaxySettings.maxSys?(ThisSystem.val(1),ThisGalaxy.val()==GalaxySettings.maxGal?ThisGalaxy.val(1):ThisGalaxy.val(parseInt(ThisGalaxy.val(),10)+1)):ThisSystem.val(parseInt(ThisSystem.val(),10)+1);break}$(document.body).append('<div id="cover" style="position: absolute; background: url(./images/ajax-loader-big.gif) no-repeat center center;"><div style="width: 100%; height: 100%; background: black; opacity: 0.3;"></div></div>'),$("#cover").offset(GalRows.offset()).width(GalRows.outerWidth()).height(GalRows.outerHeight()),$.get("ajax/galaxy.php",{galaxy:ThisGalaxy.val(),system:ThisSystem.val()}).complete(function(Response,RequestStatus){var ErrorOccured=!1;if(ThisGalaxy.val(OldGalaxy),ThisSystem.val(OldSystem),"success"==RequestStatus)if(void 0===(Response=$.parseJSON(Response.responseText)).Err){if(Response.msg>0){var LeftMenu_MessagesCount=LeftMenu_Messages.children("#lm_msgc");LeftMenu_MessagesCount.length>0?LeftMenu_MessagesCount.html("("+Response.msg+")"):LeftMenu_Messages.addClass("orange").append('<b id="lm_msgc">('+Response.msg+")</b>")}else LeftMenu_Messages.children("#lm_msgc").remove().end().removeClass("orange");El_FlyingFleets.html(Response.fly),colonizedCount.html(Response.PC),GalRows.html(Response.Data),ThisGalaxy.val(Response.G),ThisSystem.val(Response.S),document.location.hash=ThisGalaxy.val()+":"+ThisSystem.val(),CurrentMissilesPos="0:0:0",MissilesForm.hide("fast")}else ErrorOccured=!0;if("success"!=RequestStatus||!0===ErrorOccured){var ThisRespCode=0;ThisRespCode="success"==RequestStatus?Response.Err:"timeout"==RequestStatus?"696":"695",ShowAjaxInfo(RespCodes[ThisRespCode],"red",1500)}$("#cover").remove(),LockGalaxyForm=!1})}return AutoInput.attr("name",""),!1}}),$(window).resize(function(){$("#cover").is(":visible")&&$("#cover").offset(GalRows.offset()).width(GalRows.outerWidth()).height(GalRows.outerHeight())}),!0===UseAjax&&void 0!==document.location.hash&&""!=document.location.hash){var Position=document.location.hash.replace("#","").split(":");ThisGalaxy.val()==Position[0]&&ThisSystem.val()==Position[1]||(ThisGalaxy.val(Position[0]),ThisSystem.val(Position[1]),$("#galaxy_form").submit())}});