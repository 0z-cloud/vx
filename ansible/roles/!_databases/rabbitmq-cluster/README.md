## Rabbitmq

[![Ansible Galaxy](http://img.shields.io/badge/galaxy-DimitriSteyaert/rabbitmq-660198.svg?style=flat)](https://galaxy.ansible.com/detail#/role/DimitriSteyaert)


This role installs and configures a RabbitMQ server (with the version of your choice) and lets you setup a RabbitMQ cluster.

### Installation

This role requires at least Ansible `v1.9`. To install it, run:

```Shell
ansible-galaxy install DimitriSteyaert/rabbitmq
```


### Role variables

List of default variables available in the inventory:

```YAML
---
# General RabbitMQ parameters that apply to this role itself
rabbitmq_version: latest
rabbitmq_server_state: present
rabbitmq_server_purge: no
rabbitmq_ulimit: 65536

# RabbitMQ config parameters
rabbitmq_amqp_port: 5672
rabbitmq_epmd_port: 4369
rabbitmq_node_port: 25672
rabbitmq_memory_high_watermark: 0.5
rabbitmq_disk_free_limit: 1GB
rabbitmq_queue_master_locator: min-masters
rabbitmq_hipe_compile: "false"

# RabbitMQ plugins
rabbitmq_plugins:
  - name: rabbitmq_management
    state: enabled
  - name: rabbitmq_management_agent
    state: enabled

# RabbitMQ management of vhosts, users,...
rabbitmq_remove_guest: false
rabbitmq_vhosts: []
rabbitmq_users: []
rabbitmq_queues: []
rabbitmq_exchanges: []

# RabbitMQ cluster parameters
rabbitmq_cluster: false
rabbitmq_cluster_master: false
rabbitmq_master: your_cluster_master
rabbitmq_erlang_cookie: NEPTQRGCQDKAHSOSFDML
```


### Detailed usage guide

If you just enable this role on your machine(s) then you perform a basic RabbitMQ server installation with the latest version. But by tweaking the role variables you can choose to install another version of RabbitMQ server or setup a RabbitMQ cluster. You can also choose to let Ansible manage your vhosts, queues, exchanges and users by filling up these arrays. Just follow the examples below to realise this.
#### Examples

This is a basic playbook to install Rabbitmq with the default variables:

```YAML
---
- hosts: all
  roles:
    - rabbitmq
```

If you wish to install a RabbitMQ server version that is not the latest available version from the package manager then you can define the ```rabbitmq_version``` variable like this:

```YAML
---
rabbitmq_version: '3.3.5-1.1+deb8u1'
```

If you want to work with a full blown RabbitMQ cluster (consisting of 3 nodes because... best practices) you can use this example. Just make sure that your RabbitMQ nodes belong the a group called **rabbitmq** in your Ansible inventory

```YAML
---
- hosts: rabbitmq01
  vars:
    - rabbitmq_remove_guest: true
    - rabbitmq_vhosts:
      - name: /
        state: present
    - rabbitmq_users:
      - user: admin
        password: SECURE_PASSWORD
        force: no
        vhost: /
        configure_priv: .*
        read_priv: .*
        write_priv: .*
        tags: administrator
    - rabbitmq_queues:
      - name: queue_name
        vhost: /
        state: present
        login_user: admin
        login_password: SECURE_PASSWORD
        durable: 'true'
    - rabbitmq_exchanges:
      - name: exchange_name
        vhost: '/'
        state: present
        login_user: admin
        login_password: SECURE_PASSWORD
        exchange_type: direct
        durable: 'true'
    - rabbitmq_cluster: true
    - rabbitmq_erlang_cookie: NEPTQRGCQDKAHSOSFDML
    - rabbitmq_cluster_master: true
  roles:
    - rabbitmq

- hosts: rabbitmq02
  vars:
    - rabbitmq_cluster: true
    - rabbitmq_erlang_cookie: NEPTQRGCQDKAHSOSFDML
    - rabbitmq_cluster_master: false
    - rabbitmq_master: rabbitmq01
  roles:
    - rabbitmq

- hosts: rabbitmq03
  vars:
    - rabbitmq_cluster: true
    - rabbitmq_erlang_cookie: NEPTQRGCQDKAHSOSFDML
    - rabbitmq_cluster_master: false
    - rabbitmq_master: rabbitmq01
  roles:
    - rabbitmq
```

### Authors and license

The `rabbitmq` role was written by:

- [Dimitri Steyaert](https://www.steyaert.be) | [e-mail](mailto:dimitri@steyaert.be) | [Twitter](https://twitter.com/DimitriSteyaert)

License: [MIT](https://tldrlegal.com/license/mit-license)

***

README generated by [Ansigenome](https://github.com/nickjj/ansigenome/).
